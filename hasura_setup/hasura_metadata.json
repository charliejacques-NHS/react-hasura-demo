{
  "resource_version": 97,
  "metadata": {
    "version": 3,
    "sources": [
      {
        "name": "data",
        "kind": "postgres",
        "tables": [
          {
            "table": {
              "name": "basket",
              "schema": "public"
            },
            "object_relationships": [
              {
                "name": "user",
                "using": {
                  "foreign_key_constraint_on": "user_id"
                }
              }
            ],
            "array_relationships": [
              {
                "name": "basket_products",
                "using": {
                  "foreign_key_constraint_on": {
                    "column": "basket_id",
                    "table": {
                      "name": "basket_products",
                      "schema": "public"
                    }
                  }
                }
              }
            ],
            "insert_permissions": [
              {
                "role": "user_base",
                "permission": {
                  "check": {
                    "user_id": {
                      "_eq": "X-Hasura-User-Id"
                    }
                  },
                  "columns": ["user_id"]
                },
                "comment": ""
              },
              {
                "role": "user_elevated",
                "permission": {
                  "check": {},
                  "columns": ["user_id"]
                },
                "comment": ""
              }
            ],
            "select_permissions": [
              {
                "role": "user_base",
                "permission": {
                  "columns": ["complete", "created_at", "id", "updated_at"],
                  "filter": {
                    "user_id": {
                      "_eq": "X-Hasura-User-Id"
                    }
                  },
                  "allow_aggregations": true
                },
                "comment": ""
              },
              {
                "role": "user_elevated",
                "permission": {
                  "columns": [
                    "complete",
                    "created_at",
                    "id",
                    "updated_at",
                    "user_id"
                  ],
                  "filter": {},
                  "allow_aggregations": true
                },
                "comment": ""
              }
            ],
            "update_permissions": [
              {
                "role": "user_base",
                "permission": {
                  "columns": ["complete"],
                  "filter": {
                    "user_id": {
                      "_eq": "X-Hasura-User-Id"
                    }
                  },
                  "check": {
                    "user_id": {
                      "_eq": "X-Hasura-User-Id"
                    }
                  }
                },
                "comment": ""
              },
              {
                "role": "user_elevated",
                "permission": {
                  "columns": ["complete", "id", "user_id"],
                  "filter": {},
                  "check": {}
                },
                "comment": ""
              }
            ],
            "delete_permissions": [
              {
                "role": "user_elevated",
                "permission": {
                  "filter": {}
                },
                "comment": ""
              }
            ]
          },
          {
            "table": {
              "name": "basket_products",
              "schema": "public"
            },
            "object_relationships": [
              {
                "name": "basket",
                "using": {
                  "foreign_key_constraint_on": "basket_id"
                }
              },
              {
                "name": "product",
                "using": {
                  "foreign_key_constraint_on": "product_id"
                }
              }
            ],
            "insert_permissions": [
              {
                "role": "user_base",
                "permission": {
                  "check": {
                    "basket": {
                      "user_id": {
                        "_eq": "X-Hasura-User-Id"
                      }
                    }
                  },
                  "columns": [
                    "created_at",
                    "updated_at",
                    "basket_id",
                    "id",
                    "product_id"
                  ]
                },
                "comment": ""
              },
              {
                "role": "user_elevated",
                "permission": {
                  "check": {},
                  "columns": [
                    "created_at",
                    "updated_at",
                    "basket_id",
                    "id",
                    "product_id"
                  ]
                },
                "comment": ""
              }
            ],
            "select_permissions": [
              {
                "role": "user_base",
                "permission": {
                  "columns": [
                    "created_at",
                    "updated_at",
                    "basket_id",
                    "id",
                    "product_id"
                  ],
                  "filter": {
                    "basket": {
                      "user_id": {
                        "_eq": "X-Hasura-User-Id"
                      }
                    }
                  },
                  "allow_aggregations": true
                },
                "comment": ""
              },
              {
                "role": "user_elevated",
                "permission": {
                  "columns": [
                    "created_at",
                    "updated_at",
                    "basket_id",
                    "id",
                    "product_id"
                  ],
                  "filter": {}
                },
                "comment": ""
              }
            ],
            "update_permissions": [
              {
                "role": "user_base",
                "permission": {
                  "columns": [
                    "created_at",
                    "updated_at",
                    "basket_id",
                    "id",
                    "product_id"
                  ],
                  "filter": {
                    "basket": {
                      "user_id": {
                        "_eq": "X-Hasura-User-Id"
                      }
                    }
                  },
                  "check": {
                    "basket": {
                      "user_id": {
                        "_eq": "X-Hasura-User-Id"
                      }
                    }
                  }
                },
                "comment": ""
              },
              {
                "role": "user_elevated",
                "permission": {
                  "columns": [
                    "created_at",
                    "updated_at",
                    "basket_id",
                    "id",
                    "product_id"
                  ],
                  "filter": {},
                  "check": {}
                },
                "comment": ""
              }
            ],
            "delete_permissions": [
              {
                "role": "user_base",
                "permission": {
                  "filter": {
                    "basket": {
                      "user_id": {
                        "_eq": "X-Hasura-User-Id"
                      }
                    }
                  }
                },
                "comment": ""
              },
              {
                "role": "user_elevated",
                "permission": {
                  "filter": {}
                },
                "comment": ""
              }
            ]
          },
          {
            "table": {
              "name": "categories",
              "schema": "public"
            },
            "array_relationships": [
              {
                "name": "products",
                "using": {
                  "foreign_key_constraint_on": {
                    "column": "category_id",
                    "table": {
                      "name": "product_categories",
                      "schema": "public"
                    }
                  }
                }
              }
            ],
            "select_permissions": [
              {
                "role": "user_base",
                "permission": {
                  "columns": ["friendly_name", "name", "id"],
                  "filter": {},
                  "allow_aggregations": true
                },
                "comment": ""
              },
              {
                "role": "user_elevated",
                "permission": {
                  "columns": ["friendly_name", "name", "id"],
                  "filter": {},
                  "allow_aggregations": true
                },
                "comment": ""
              }
            ],
            "update_permissions": [
              {
                "role": "user_base",
                "permission": {
                  "columns": ["friendly_name", "name", "id"],
                  "filter": {},
                  "check": {}
                },
                "comment": ""
              }
            ]
          },
          {
            "table": {
              "name": "feature_flags",
              "schema": "public"
            },
            "array_relationships": [
              {
                "name": "user_groups",
                "using": {
                  "foreign_key_constraint_on": {
                    "column": "feature_flag_id",
                    "table": {
                      "name": "user_group_feature_flags",
                      "schema": "public"
                    }
                  }
                }
              },
              {
                "name": "users",
                "using": {
                  "foreign_key_constraint_on": {
                    "column": "feature_flag_id",
                    "table": {
                      "name": "user_feature_flags",
                      "schema": "public"
                    }
                  }
                }
              }
            ],
            "insert_permissions": [
              {
                "role": "user_elevated",
                "permission": {
                  "check": {
                    "_and": [
                      {
                        "users": {
                          "user_id": {
                            "_eq": "X-Hasura-User-Id"
                          }
                        }
                      },
                      {
                        "user_groups": {
                          "user_group": {
                            "name": {
                              "_eq": "user_base"
                            }
                          }
                        }
                      }
                    ]
                  },
                  "columns": [
                    "enabled",
                    "friendly_name",
                    "name",
                    "created_at",
                    "updated_at",
                    "id"
                  ]
                },
                "comment": ""
              }
            ],
            "select_permissions": [
              {
                "role": "user_base",
                "permission": {
                  "columns": [
                    "enabled",
                    "friendly_name",
                    "name",
                    "created_at",
                    "updated_at",
                    "id"
                  ],
                  "filter": {
                    "_and": [
                      {
                        "users": {
                          "user_id": {
                            "_eq": "X-Hasura-User-Id"
                          }
                        }
                      },
                      {
                        "user_groups": {
                          "user_group": {
                            "users": {
                              "user_id": {
                                "_eq": "X-Hasura-User-Id"
                              }
                            }
                          }
                        }
                      }
                    ]
                  },
                  "allow_aggregations": true
                },
                "comment": ""
              },
              {
                "role": "user_elevated",
                "permission": {
                  "columns": [
                    "enabled",
                    "friendly_name",
                    "name",
                    "created_at",
                    "updated_at",
                    "id"
                  ],
                  "filter": {
                    "_or": [
                      {
                        "users": {
                          "user_id": {
                            "_eq": "X-Hasura-User-Id"
                          }
                        }
                      },
                      {
                        "user_groups": {
                          "user_group": {
                            "users": {
                              "user_id": {
                                "_eq": "X-Hasura-User-Id"
                              }
                            }
                          }
                        }
                      }
                    ]
                  },
                  "allow_aggregations": true
                },
                "comment": ""
              }
            ],
            "update_permissions": [
              {
                "role": "user_elevated",
                "permission": {
                  "columns": [
                    "enabled",
                    "friendly_name",
                    "name",
                    "created_at",
                    "updated_at",
                    "id"
                  ],
                  "filter": {
                    "_and": [
                      {
                        "users": {
                          "user_id": {
                            "_eq": "X-Hasura-User-Id"
                          }
                        }
                      },
                      {
                        "user_groups": {
                          "user_group": {
                            "name": {
                              "_eq": "user_base"
                            }
                          }
                        }
                      }
                    ]
                  },
                  "check": {
                    "_and": [
                      {
                        "users": {
                          "user_id": {
                            "_eq": "X-Hasura-User-Id"
                          }
                        }
                      },
                      {
                        "user_groups": {
                          "user_group": {
                            "name": {
                              "_eq": "user_base"
                            }
                          }
                        }
                      }
                    ]
                  }
                },
                "comment": ""
              }
            ],
            "delete_permissions": [
              {
                "role": "user_elevated",
                "permission": {
                  "filter": {
                    "_and": [
                      {
                        "users": {
                          "user_id": {
                            "_eq": "X-Hasura-User-Id"
                          }
                        }
                      },
                      {
                        "user_groups": {
                          "user_group": {
                            "name": {
                              "_eq": "user_base"
                            }
                          }
                        }
                      }
                    ]
                  }
                },
                "comment": ""
              }
            ]
          },
          {
            "table": {
              "name": "product_categories",
              "schema": "public"
            },
            "object_relationships": [
              {
                "name": "category",
                "using": {
                  "foreign_key_constraint_on": "category_id"
                }
              },
              {
                "name": "product",
                "using": {
                  "foreign_key_constraint_on": "product_id"
                }
              }
            ],
            "insert_permissions": [
              {
                "role": "user_elevated",
                "permission": {
                  "check": {},
                  "columns": ["category_id", "id", "product_id"]
                },
                "comment": ""
              }
            ],
            "select_permissions": [
              {
                "role": "user_base",
                "permission": {
                  "columns": ["category_id", "id", "product_id"],
                  "filter": {},
                  "allow_aggregations": true
                },
                "comment": ""
              },
              {
                "role": "user_elevated",
                "permission": {
                  "columns": ["category_id", "id", "product_id"],
                  "filter": {},
                  "allow_aggregations": true
                },
                "comment": ""
              }
            ]
          },
          {
            "table": {
              "name": "products",
              "schema": "public"
            },
            "array_relationships": [
              {
                "name": "categories",
                "using": {
                  "foreign_key_constraint_on": {
                    "column": "product_id",
                    "table": {
                      "name": "product_categories",
                      "schema": "public"
                    }
                  }
                }
              }
            ],
            "insert_permissions": [
              {
                "role": "user_elevated",
                "permission": {
                  "check": {},
                  "columns": ["description", "image_src", "name", "price"]
                },
                "comment": ""
              }
            ],
            "select_permissions": [
              {
                "role": "user_base",
                "permission": {
                  "columns": [
                    "price",
                    "description",
                    "image_src",
                    "name",
                    "created_at",
                    "updated_at",
                    "id"
                  ],
                  "filter": {},
                  "allow_aggregations": true
                },
                "comment": ""
              },
              {
                "role": "user_elevated",
                "permission": {
                  "columns": [
                    "description",
                    "id",
                    "image_src",
                    "name",
                    "price"
                  ],
                  "filter": {},
                  "allow_aggregations": true
                },
                "comment": ""
              }
            ],
            "update_permissions": [
              {
                "role": "user_elevated",
                "permission": {
                  "columns": ["description", "image_src", "name", "price"],
                  "filter": {},
                  "check": {}
                },
                "comment": ""
              }
            ]
          },
          {
            "table": {
              "name": "user_feature_flags",
              "schema": "public"
            },
            "object_relationships": [
              {
                "name": "feature_flag",
                "using": {
                  "foreign_key_constraint_on": "feature_flag_id"
                }
              },
              {
                "name": "user",
                "using": {
                  "foreign_key_constraint_on": "user_id"
                }
              }
            ]
          },
          {
            "table": {
              "name": "user_group_feature_flags",
              "schema": "public"
            },
            "object_relationships": [
              {
                "name": "feature_flag",
                "using": {
                  "foreign_key_constraint_on": "feature_flag_id"
                }
              },
              {
                "name": "user_group",
                "using": {
                  "foreign_key_constraint_on": "user_group_id"
                }
              }
            ]
          },
          {
            "table": {
              "name": "user_groups",
              "schema": "public"
            },
            "array_relationships": [
              {
                "name": "feature_flags",
                "using": {
                  "foreign_key_constraint_on": {
                    "column": "user_group_id",
                    "table": {
                      "name": "user_group_feature_flags",
                      "schema": "public"
                    }
                  }
                }
              },
              {
                "name": "users",
                "using": {
                  "foreign_key_constraint_on": {
                    "column": "group_id",
                    "table": {
                      "name": "user_user_group",
                      "schema": "public"
                    }
                  }
                }
              }
            ],
            "insert_permissions": [
              {
                "role": "user_elevated",
                "permission": {
                  "check": {
                    "users": {
                      "user_id": {
                        "_eq": "X-Hasura-User-Id"
                      }
                    }
                  },
                  "columns": ["friendly_name", "name", "id"]
                },
                "comment": ""
              }
            ],
            "select_permissions": [
              {
                "role": "user_base",
                "permission": {
                  "columns": ["friendly_name", "name", "id"],
                  "filter": {
                    "users": {
                      "user_id": {
                        "_eq": "X-Hasura-User-Id"
                      }
                    }
                  }
                },
                "comment": ""
              },
              {
                "role": "user_elevated",
                "permission": {
                  "columns": ["friendly_name", "name", "id"],
                  "filter": {
                    "users": {
                      "user_id": {
                        "_eq": "X-Hasura-User-Id"
                      }
                    }
                  },
                  "allow_aggregations": true
                },
                "comment": ""
              }
            ],
            "update_permissions": [
              {
                "role": "user_elevated",
                "permission": {
                  "columns": ["friendly_name", "name", "id"],
                  "filter": {
                    "users": {
                      "user_id": {
                        "_eq": "X-Hasura-User-Id"
                      }
                    }
                  },
                  "check": {
                    "users": {
                      "user_id": {
                        "_eq": "X-Hasura-User-Id"
                      }
                    }
                  }
                },
                "comment": ""
              }
            ],
            "delete_permissions": [
              {
                "role": "user_elevated",
                "permission": {
                  "filter": {
                    "users": {
                      "user_id": {
                        "_eq": "X-Hasura-User-Id"
                      }
                    }
                  }
                },
                "comment": ""
              }
            ]
          },
          {
            "table": {
              "name": "user_user_group",
              "schema": "public"
            },
            "object_relationships": [
              {
                "name": "user",
                "using": {
                  "foreign_key_constraint_on": "user_id"
                }
              },
              {
                "name": "user_group",
                "using": {
                  "foreign_key_constraint_on": "group_id"
                }
              }
            ]
          },
          {
            "table": {
              "name": "users",
              "schema": "public"
            },
            "array_relationships": [
              {
                "name": "baskets",
                "using": {
                  "foreign_key_constraint_on": {
                    "column": "user_id",
                    "table": {
                      "name": "basket",
                      "schema": "public"
                    }
                  }
                }
              },
              {
                "name": "feature_flags",
                "using": {
                  "foreign_key_constraint_on": {
                    "column": "user_id",
                    "table": {
                      "name": "user_feature_flags",
                      "schema": "public"
                    }
                  }
                }
              },
              {
                "name": "groups",
                "using": {
                  "foreign_key_constraint_on": {
                    "column": "user_id",
                    "table": {
                      "name": "user_user_group",
                      "schema": "public"
                    }
                  }
                }
              }
            ],
            "insert_permissions": [
              {
                "role": "user_elevated",
                "permission": {
                  "check": {
                    "groups": {
                      "user_group": {
                        "name": {
                          "_eq": "user_base"
                        }
                      }
                    }
                  },
                  "columns": ["username", "created_at", "updated_at", "id"]
                },
                "comment": ""
              }
            ],
            "select_permissions": [
              {
                "role": "user_base",
                "permission": {
                  "columns": ["username", "created_at", "updated_at", "id"],
                  "filter": {
                    "id": {
                      "_eq": "X-Hasura-User-Id"
                    }
                  },
                  "allow_aggregations": true
                },
                "comment": ""
              },
              {
                "role": "user_elevated",
                "permission": {
                  "columns": ["username", "created_at", "updated_at", "id"],
                  "filter": {
                    "groups": {
                      "user_group": {
                        "name": {
                          "_eq": "user_base"
                        }
                      }
                    }
                  },
                  "allow_aggregations": true
                },
                "comment": ""
              }
            ],
            "update_permissions": [
              {
                "role": "user_elevated",
                "permission": {
                  "columns": ["username", "created_at", "updated_at", "id"],
                  "filter": {
                    "groups": {
                      "user_group": {
                        "name": {
                          "_eq": "user_base"
                        }
                      }
                    }
                  },
                  "check": {
                    "groups": {
                      "user_group": {
                        "name": {
                          "_eq": "user_base"
                        }
                      }
                    }
                  }
                },
                "comment": ""
              }
            ],
            "delete_permissions": [
              {
                "role": "user_elevated",
                "permission": {
                  "filter": {
                    "groups": {
                      "user_group": {
                        "name": {
                          "_eq": "user_base"
                        }
                      }
                    }
                  }
                },
                "comment": ""
              }
            ]
          }
        ],
        "configuration": {
          "connection_info": {
            "database_url": {
              "from_env": "PG_DATABASE_URL"
            },
            "isolation_level": "read-committed",
            "use_prepared_statements": false
          }
        }
      }
    ],
    "query_collections": [
      {
        "name": "allowed-queries",
        "definition": {
          "queries": [
            {
              "name": "GET_USER_DETAILS",
              "query": "query GET_USER_DETAILS($username: String!) {\n  users(where: {username:{_eq: $username}}) {\n    id\n    groups {\n      user_group {\n        id\n        name\n      }\n    }\n  }\n}"
            }
          ]
        }
      }
    ],
    "allowlist": [
      {
        "collection": "allowed-queries",
        "scope": {
          "global": true
        }
      }
    ],
    "actions": [
      {
        "name": "get_user_details",
        "definition": {
          "handler": "{{NODE_APP_URL}}/api/user/details",
          "output_type": "GetUserDetailsOutput",
          "forward_client_headers": true,
          "headers": [
            {
              "name": "Authorization",
              "value": "Bearer {{MICROSERVICE_API_KEY}}"
            }
          ],
          "arguments": [
            {
              "name": "args",
              "type": "GetUserDetailsInput!"
            }
          ],
          "request_transform": {
            "body": {
              "action": "transform",
              "template": "{\n  \"username\": {{$body.input.args.username}}\n}"
            },
            "method": "POST",
            "query_params": {},
            "template_engine": "Kriti",
            "version": 2
          },
          "type": "query"
        },
        "comment": "get_user_details",
        "permissions": [
          {
            "role": "unauthorized"
          }
        ]
      },
      {
        "name": "node_app_health_check",
        "definition": {
          "handler": "{{NODE_APP_URL}}/health",
          "output_type": "NodeAppHealthCheckOutput",
          "request_transform": {
            "body": {
              "action": "transform",
              "template": "{}"
            },
            "method": "GET",
            "query_params": {},
            "request_headers": {
              "add_headers": {},
              "remove_headers": ["content-type"]
            },
            "template_engine": "Kriti",
            "version": 2
          },
          "type": "query"
        },
        "comment": "node_app_health_check"
      }
    ],
    "custom_types": {
      "input_objects": [
        {
          "name": "GetUserDetailsInput",
          "fields": [
            {
              "name": "username",
              "type": "String!"
            }
          ]
        },
        {
          "name": "CompleteBasketInput",
          "fields": [
            {
              "name": "user_id",
              "type": "String!"
            }
          ]
        }
      ],
      "objects": [
        {
          "name": "NodeAppHealthCheckOutput",
          "fields": [
            {
              "name": "status",
              "type": "String!"
            }
          ]
        },
        {
          "name": "GetUserDetailsOutput",
          "fields": [
            {
              "name": "user_id",
              "type": "String!"
            },
            {
              "name": "group_name",
              "type": "String!"
            },
            {
              "name": "group_id",
              "type": "String!"
            }
          ]
        },
        {
          "name": "CompleteBasketOutput",
          "fields": [
            {
              "name": "message",
              "type": "String!"
            }
          ]
        }
      ]
    },
    "rest_endpoints": [
      {
        "comment": "Fetches user details",
        "definition": {
          "query": {
            "collection_name": "allowed-queries",
            "query_name": "GET_USER_DETAILS"
          }
        },
        "methods": ["GET"],
        "name": "GET_USER_DETAILS",
        "url": "get-user-details/:username"
      }
    ],
    "backend_configs": {
      "dataconnector": {
        "athena": {
          "uri": "http://data-connector-agent:8081/api/v1/athena"
        },
        "mariadb": {
          "uri": "http://data-connector-agent:8081/api/v1/mariadb"
        },
        "mysql8": {
          "uri": "http://data-connector-agent:8081/api/v1/mysql"
        },
        "oracle": {
          "uri": "http://data-connector-agent:8081/api/v1/oracle"
        },
        "snowflake": {
          "uri": "http://data-connector-agent:8081/api/v1/snowflake"
        }
      }
    }
  }
}
